<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Midnight Shift: The Paradox (FNAF Fan Game)</title>
    <style>
        /* CSS - DESIGN E ANIMAÇÕES */
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Courier New', Courier, monospace; color: white; }
        #game-container { position: relative; width: 100vw; height: 100vh; display: flex; justify-content: center; align-items: center; }
        canvas { background: #111; image-rendering: pixelated; width: 100%; height: 100%; max-width: 1280px; max-height: 720px; }
        
        .ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        .clickable { pointer-events: auto; cursor: pointer; }

        /* Estática da Câmera */
        #static-fx { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.05; background: url('https://media.giphy.com/media/oEI9uWUqnW3Fe/giphy.gif'); pointer-events: none; display: none; }

        /* Menu Styles */
        .menu-btn { background: rgba(255, 255, 255, 0.1); border: 1px solid #fff; color: #fff; padding: 15px 40px; font-size: 20px; transition: 0.3s; margin: 10px; }
        .menu-btn:hover { background: #fff; color: #000; }

        /* Jumpscare Flash */
        @keyframes flash { 0% { opacity: 1; } 100% { opacity: 0; } }
        .jumpscare-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: red; display: none; z-index: 999; }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="mainCanvas"></canvas>
    <div id="static-fx"></div>
    <div id="jumpscare" class="jumpscare-overlay"></div>
    
    <div id="ui-overlay" class="ui-layer"></div>
</div>

<script>
/**
 * MIDNIGHT SHIFT: THE PARADOX - ENGINE CORE
 * Desenvolvido como Fan Game de Five Nights at Freddy's
 */

const canvas = document.getElementById('mainCanvas');
const ctx = canvas.getContext('2d');
canvas.width = 1280;
canvas.height = 720;

// CONFIGURAÇÃO GLOBAL
const GameState = {
    MENU: 0,
    INTRO_CAR: 1,
    TUTORIAL: 2,
    OFFICE: 3,
    CAMERAS: 4,
    MINIGAME: 5,
    JUMPSCARE: 6,
    WIN: 7
};

let currentState = GameState.MENU;
let currentNight = 1;
let power = 100;
let time = 0; // 0 a 120 (2 minutos)
let camActive = 1;
let animatronics = [
    { name: "Shadow", pos: 1, aggro: 2, lastMove: 0 },
    { name: "Echo", pos: 2, aggro: 1, lastMove: 0 }
];

// RECURSOS SONOROS (SINTETIZADOS)
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playTone(freq, duration, type = "sine") {
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.type = type;
    osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
    gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
    osc.connect(gain);
    gain.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + duration);
}

// --- 1. TELA INICIAL ---
function drawMenu() {
    ctx.fillStyle = "black";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    ctx.fillStyle = "white";
    ctx.font = "60px Courier New";
    ctx.fillText("MIDNIGHT SHIFT", 100, 200);
    ctx.font = "20px Courier New";
    ctx.fillText("THE PARADOX - FAN GAME", 100, 240);

    ctx.fillStyle = Math.random() > 0.95 ? "#333" : "white"; // Efeito Glitch
    ctx.fillText("> NEW GAME", 100, 400);
    ctx.fillText("> CREDITS", 100, 450);
}

// --- 3. INTRODUÇÃO (CARRO) ---
let carPos = 0;
let roadY = 0;
function drawCarIntro() {
    roadY += 10;
    if (roadY > 100) roadY = 0;

    ctx.fillStyle = "#050505";
    ctx.fillRect(0,0, canvas.width, canvas.height);
    
    // Desenho da estrada (Pseudo-3D)
    ctx.strokeStyle = "white";
    ctx.lineWidth = 2;
    for(let i=0; i<10; i++) {
        ctx.beginPath();
        ctx.moveTo(canvas.width/2 - (i*50), canvas.height);
        ctx.lineTo(canvas.width/2 - (i*5), 300);
        ctx.stroke();
    }

    // Carro do jogador
    ctx.fillStyle = "red";
    ctx.fillRect(canvas.width/2 - 50 + carPos, 500, 100, 60);
    ctx.fillStyle = "black";
    ctx.fillRect(canvas.width/2 - 40 + carPos, 510, 80, 20);

    ctx.fillStyle = "white";
    ctx.fillText("Use A/D para dirigir até a pizzaria", 500, 100);
}

// --- 5. MINI GAMES 2D (LORE) ---
let miniPlayer = { x: 100, y: 500 };
function drawMinigame() {
    ctx.fillStyle = "purple"; // Estilo retro
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    ctx.fillStyle = "black"; // Jogador pixel
    ctx.fillRect(miniPlayer.x, miniPlayer.y, 40, 80);
    
    ctx.fillStyle = "white";
    ctx.font = "20px 'Press Start 2P', cursive";
    ctx.fillText("ELE ESTÁ OBSERVANDO...", 300, 200);
}

// --- 6 & 7. ESCRITÓRIO E IA ---
function drawOffice() {
    // Gradiente para profundidade 3D simulada
    let grad = ctx.createRadialGradient(canvas.width/2, canvas.height/2, 50, canvas.width/2, canvas.height/2, 800);
    grad.addColorStop(0, "#222");
    grad.addColorStop(1, "black");
    ctx.fillStyle = grad;
    ctx.fillRect(0,0, canvas.width, canvas.height);

    // Mesa e Ventilação
    ctx.fillStyle = "#111";
    ctx.fillRect(400, 300, 480, 200);
    
    // UI de Energia
    ctx.fillStyle = "lime";
    ctx.fillRect(50, 650, power * 2, 20);
    ctx.fillText("POWER: " + Math.floor(power) + "%", 50, 640);
    ctx.fillText("TIME: " + Math.floor(time/20) + " AM", 1100, 50);

    if (power <= 0) gameOver("FALTA DE ENERGIA");
}

// LOGICA DE IA
function updateAI() {
    animatronics.forEach(ani => {
        if (Math.random() * 1000 < ani.aggro * currentNight) {
            ani.pos++;
            console.log(ani.name + " moveu para sala " + ani.pos);
            if (ani.pos > 5) triggerJumpscare(ani.name);
        }
    });
}

// --- 9. JUMPSCARE ---
function triggerJumpscare(name) {
    currentState = GameState.JUMPSCARE;
    document.getElementById('jumpscare').style.display = 'block';
    playTone(100, 1, "sawtooth");
    setTimeout(() => {
        location.reload();
    }, 2000);
}

// LOOP PRINCIPAL
function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    switch(currentState) {
        case GameState.MENU: drawMenu(); break;
        case GameState.INTRO_CAR: drawCarIntro(); break;
        case GameState.OFFICE: 
            drawOffice(); 
            power -= 0.01 * (currentNight);
            time += 0.01;
            updateAI();
            if(time > 120) { currentState = GameState.MINIGAME; time = 0; }
            break;
        case GameState.MINIGAME: drawMinigame(); break;
    }

    requestAnimationFrame(gameLoop);
}

// INPUTS
window.addEventListener('keydown', (e) => {
    if (currentState === GameState.INTRO_CAR) {
        if (e.key === 'a') carPos -= 5;
        if (e.key === 'd') carPos += 5;
        if (Math.abs(carPos) > 200) currentState = GameState.OFFICE;
    }
    if (currentState === GameState.MENU) currentState = GameState.INTRO_CAR;
    if (currentState === GameState.MINIGAME) {
        if (e.key === 'ArrowRight') miniPlayer.x += 10;
        if (miniPlayer.x > 1000) { currentNight++; currentState = GameState.OFFICE; miniPlayer.x = 100; }
    }
});

// Inicialização
playTone(200, 0.1);
gameLoop();

</script>
</body>
</html>
