<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Five Nights at Midnight - Fan Game</title>
    <style>
        :root {
            --bg-color: #050505;
            --ui-color: #00ff41;
            --danger-color: #ff0000;
            --font-main: 'Courier New', Courier, monospace;
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: var(--bg-color);
            color: white;
            font-family: var(--font-main);
            overflow: hidden;
            user-select: none;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        canvas {
            image-rendering: pixelated;
        }

        /* --- TELAS --- */
        .screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10;
        }

        .active { display: flex; }

        /* --- MENU INICIAL --- */
        #menu-screen {
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://images.unsplash.com/photo-1509248961158-e54f6934749c?auto=format&fit=crop&q=80&w=1000');
            background-size: cover;
            animation: flicker 5s infinite;
        }

        .title {
            font-size: 4rem;
            text-shadow: 3px 3px var(--danger-color);
            margin-bottom: 50px;
            letter-spacing: 10px;
        }

        .btn {
            background: rgba(255,255,255,0.1);
            border: 2px solid white;
            color: white;
            padding: 15px 40px;
            margin: 10px;
            cursor: pointer;
            font-size: 1.5rem;
            transition: 0.3s;
            text-transform: uppercase;
        }

        .btn:hover {
            background: white;
            color: black;
            box-shadow: 0 0 20px white;
        }

        /* --- INTRO CARRO --- */
        #car-intro {
            background: #000;
        }

        /* --- OFFICE --- */
        #office-container {
            width: 100%;
            height: 100%;
            background: #111;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1000px;
        }

        #office-view {
            width: 120%;
            height: 100%;
            background: linear-gradient(to right, #050505, #1a1a1a, #050505);
            position: relative;
            transition: transform 0.1s ease-out;
        }

        .fan {
            position: absolute;
            left: 50%;
            top: 40%;
            width: 100px;
            height: 100px;
            background: #333;
            border-radius: 50%;
            animation: rotate 0.2s linear infinite;
        }

        /* --- CAMERAS --- */
        #camera-monitor {
            position: absolute;
            bottom: -100%;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 100;
            transition: bottom 0.5s ease-in-out;
            border-top: 5px solid #444;
        }

        #camera-monitor.open { bottom: 0; }

        .cam-overlay {
            position: absolute;
            top: 20px;
            left: 20px;
            color: var(--ui-color);
            font-size: 1.2rem;
            pointer-events: none;
        }

        .cam-map {
            position: absolute;
            bottom: 50px;
            right: 50px;
            width: 300px;
            height: 250px;
            border: 2px solid white;
            background: rgba(0,0,0,0.5);
        }

        .cam-btn {
            position: absolute;
            width: 50px;
            height: 30px;
            background: #444;
            color: white;
            border: 1px solid #fff;
            cursor: pointer;
            font-size: 0.7rem;
        }

        .cam-btn.active-cam { background: var(--ui-color); color: black; }

        /* --- UI JOGO --- */
        #game-ui {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            pointer-events: none;
            z-index: 50;
        }

        .power-bar { width: 200px; height: 20px; border: 2px solid white; }
        #power-fill { width: 100%; height: 100%; background: var(--ui-color); transition: 0.3s; }

        /* --- JUMPSCARE --- */
        #jumpscare-overlay {
            background: #000;
            z-index: 999;
        }

        @keyframes flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
            95% { opacity: 1; }
            97% { opacity: 0.3; }
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .static {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: url('https://media.giphy.com/media/oEI9uWUicG57q/giphy.gif');
            opacity: 0.1;
            pointer-events: none;
        }

        /* Estilo Mini-Games */
        #minigame-canvas {
            border: 4px solid #fff;
            background: #000;
        }
    </style>
</head>
<body>

    <div id="game-container">
        
        <audio id="snd-menu" loop src="https://www.soundjay.com/ambient/creepy-background-01.mp3"></audio>
        
        <div id="menu-screen" class="screen active">
            <h1 class="title">MIDNIGHT AT THE WAREHOUSE</h1>
            <button class="btn" onclick="showScreen('instruction-screen')">New Game</button>
            <button class="btn" onclick="alert('Feito por IA - Fan Game Experimental')">Créditos</button>
        </div>

        <div id="instruction-screen" class="screen">
            <h2 style="color: var(--ui-color)">MANUAL DE SOBREVIVÊNCIA</h2>
            <div style="max-width: 600px; text-align: center; line-height: 1.6;">
                <p>1. Monitore as câmeras para localizar os Animatronics.</p>
                <p>2. Não deixe a energia acabar (Câmeras gastam energia).</p>
                <p>3. Se ouvir passos próximos, feche o monitor e fique em silêncio.</p>
                <p>4. Sobreviva até as 6:00 AM.</p>
                <p>CONTROLES: Mouse para olhar e interagir. Botão 'C' abre/fecha monitor.</p>
            </div>
            <button class="btn" onclick="startIntro()">INICIAR TURNO</button>
        </div>

        <div id="car-intro" class="screen">
            <canvas id="car-canvas"></canvas>
            <div style="position:absolute; bottom:20px; color:white;">Use A e D para dirigir até o galpão...</div>
        </div>

        <div id="minigame-screen" class="screen">
            <h2 id="minigame-title">MEMÓRIA DE 1987</h2>
            <canvas id="minigame-canvas" width="600" height="400"></canvas>
            <p>Use as setas para se mover</p>
        </div>

        <div id="game-screen" class="screen">
            <div id="game-ui">
                <div>NOITE <span id="night-num">1</span> | <span id="clock">12 PM</span></div>
                <div>ENERGIA: <span id="power-val">100</span>%
                    <div class="power-bar"><div id="power-fill"></div></div>
                </div>
            </div>

            <div id="office-container">
                <div id="office-view">
                    <div class="fan"></div>
                    <div style="position:absolute; bottom:0; width:100%; height:200px; background:#222; border-top:10px solid #111;"></div>
                    <div id="door-threat" style="position:absolute; right: -200px; top: 20%; width: 300px; height: 500px; background: #500; transition: 0.5s; opacity:0"></div>
                </div>
            </div>

            <div id="camera-monitor">
                <div class="static"></div>
                <canvas id="cam-render" style="width:100%; height:100%"></canvas>
                <div class="cam-overlay">CAM <span id="cam-id">01</span> - FEED AO VIVO</div>
                
                <div class="cam-map">
                    <button class="cam-btn active-cam" style="top:10px; left:10px;" onclick="changeCam(1, this)">CAM 1</button>
                    <button class="cam-btn" style="top:10px; right:10px;" onclick="changeCam(2, this)">CAM 2</button>
                    <button class="cam-btn" style="bottom:10px; left:10px;" onclick="changeCam(3, this)">CAM 3</button>
                    <button class="cam-btn" style="bottom:10px; right:10px;" onclick="changeCam(4, this)">CAM 4</button>
                </div>
            </div>

            <button id="toggle-cam" style="position:absolute; bottom:10px; left:50%; transform:translateX(-50%); width:300px; height:40px; background:rgba(255,255,255,0.2); border:1px solid white; z-index:200; cursor:pointer; color:white;">MONITOR (C)</button>
        </div>

        <div id="jumpscare-overlay" class="screen">
            <img id="jumpscare-img" src="" style="width:100%; height:100%; object-fit: cover; display:none;">
            <h1 style="color:red; font-size:5rem;">FIM DE JOGO</h1>
            <button class="btn" onclick="location.reload()">TENTAR NOVAMENTE</button>
        </div>

        <div id="win-screen" class="screen">
            <h1 style="color:gold;">6:00 AM</h1>
            <p>Você sobreviveu à noite!</p>
            <button class="btn" id="next-night-btn">PRÓXIMA NOITE</button>
        </div>

    </div>

    <script>
        /* --- CONFIGURAÇÕES GERAIS --- */
        const state = {
            currentNight: 1,
            time: 0, // 0 a 6 (horas)
            power: 100,
            isMonitorOpen: false,
            currentCam: 1,
            gameActive: false,
            difficulty: { 1: 2, 2: 4, 3: 7, 4: 15 },
            animatronicPos: [0, 0, 0], // Posição de 3 robôs (0=Longe, 4=Ataque)
            officePan: 0
        };

        const screens = ['menu-screen', 'instruction-screen', 'car-intro', 'game-screen', 'jumpscare-overlay', 'win-screen', 'minigame-screen'];

        function showScreen(id) {
            screens.forEach(s => document.getElementById(s).classList.remove('active'));
            document.getElementById(id).classList.add('active');
        }

        /* --- SISTEMA DE ÁUDIO --- */
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        function playBeep(freq, dur) {
            const osc = ctx.createOscillator();
            const gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.frequency.value = freq;
            gain.gain.setValueAtTime(0.1, ctx.currentTime);
            osc.start();
            osc.stop(ctx.currentTime + dur);
        }

        /* --- INTRO CARRO --- */
        function startIntro() {
            showScreen('car-intro');
            const canvas = document.getElementById('car-canvas');
            const c = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            
            let carX = canvas.width / 2;
            let roadOffset = 0;
            let introTimer = 0;

            const loop = () => {
                if(introTimer > 300) {
                    startMiniGame();
                    return;
                }
                c.fillStyle = '#050505';
                c.fillRect(0,0,canvas.width, canvas.height);
                
                // Estrada
                c.fillStyle = '#222';
                c.beginPath();
                c.moveTo(canvas.width/2 - 50, 0);
                c.lineTo(canvas.width/2 + 50, 0);
                c.lineTo(canvas.width, canvas.height);
                c.lineTo(0, canvas.height);
                c.fill();

                // Faixas
                c.strokeStyle = '#fff';
                c.setLineDash([20, 20]);
                c.lineDashOffset = -roadOffset;
                c.beginPath();
                c.moveTo(canvas.width/2, 0);
                c.lineTo(canvas.width/2, canvas.height);
                c.stroke();

                // Carro (Simples)
                c.fillStyle = 'red';
                c.fillRect(carX - 30, canvas.height - 100, 60, 40);
                c.fillStyle = 'black';
                c.fillRect(carX - 35, canvas.height - 90, 10, 20);
                c.fillRect(carX + 25, canvas.height - 90, 10, 20);

                roadOffset += 10;
                introTimer++;
                requestAnimationFrame(loop);
            };
            loop();
        }

        /* --- MINI GAMES 2D (LORE) --- */
        function startMiniGame() {
            showScreen('minigame-screen');
            const canvas = document.getElementById('minigame-canvas');
            const c = canvas.getContext('2d');
            let player = { x: 50, y: 300 };
            let frames = 0;

            const loop = () => {
                if(frames > 200) {
                    startGame();
                    return;
                }
                c.fillStyle = 'black';
                c.fillRect(0,0,600,400);
                
                c.fillStyle = 'purple'; // Personagem da Lore
                c.fillRect(player.x, player.y, 20, 40);
                
                c.fillStyle = 'white';
                c.font = '10px Courier';
                c.fillText("VOCÊ NÃO DEVERIA ESTAR AQUI", 200, 100);

                player.x += 1;
                frames++;
                requestAnimationFrame(loop);
            };
            loop();
        }

        /* --- SISTEMA DE JOGO PRINCIPAL --- */
        function startGame() {
            showScreen('game-screen');
            state.gameActive = true;
            state.power = 100;
            state.time = 0;
            state.animatronicPos = [0, 0, 0];
            updateUI();
            
            // Loop de Tempo
            const gameClock = setInterval(() => {
                if(!state.gameActive) { clearInterval(gameClock); return; }
                state.time++;
                document.getElementById('clock').innerText = (state.time === 0 ? "12 PM" : state.time + " AM");
                if(state.time >= 6) winNight();
            }, 20000); // 2 minutos por noite (120s / 6h = 20s/hora)

            // Loop de Energia
            const powerClock = setInterval(() => {
                if(!state.gameActive) { clearInterval(powerClock); return; }
                let consumption = 0.1;
                if(state.isMonitorOpen) consumption += 0.3;
                state.power -= consumption;
                updateUI();
                if(state.power <= 0) gameOver("power_out");
            }, 500);

            // IA dos Animatronics
            const aiClock = setInterval(() => {
                if(!state.gameActive) { clearInterval(aiClock); return; }
                moveAnimatronics();
            }, 5000);
        }

        function updateUI() {
            document.getElementById('power-val').innerText = Math.floor(state.power);
            document.getElementById('power-fill').style.width = state.power + "%";
            document.getElementById('night-num').innerText = state.currentNight;
        }

        /* --- MECÂNICA DE CÂMERAS --- */
        const monitorBtn = document.getElementById('toggle-cam');
        const monitorEl = document.getElementById('camera-monitor');

        function toggleMonitor() {
            if(!state.gameActive) return;
            state.isMonitorOpen = !state.isMonitorOpen;
            if(state.isMonitorOpen) {
                monitorEl.classList.add('open');
                playBeep(400, 0.1);
                renderCam();
            } else {
                monitorEl.classList.remove('open');
                playBeep(200, 0.1);
            }
        }

        document.addEventListener('keydown', (e) => {
            if(e.key.toLowerCase() === 'c') toggleMonitor();
        });

        monitorBtn.onclick = toggleMonitor;

        function changeCam(id, btn) {
            state.currentCam = id;
            document.querySelectorAll('.cam-btn').forEach(b => b.classList.remove('active-cam'));
            btn.classList.add('active-cam');
            document.getElementById('cam-id').innerText = "0" + id;
            playBeep(600, 0.05);
            renderCam();
        }

        function renderCam() {
            const canvas = document.getElementById('cam-render');
            const c = canvas.getContext('2d');
            canvas.width = 800;
            canvas.height = 600;

            c.fillStyle = '#111';
            c.fillRect(0,0,800,600);

            // Simulação de "3D Fake" em Canvas
            c.strokeStyle = '#333';
            c.lineWidth = 2;
            for(let i=0; i<10; i++) {
                c.strokeRect(i*40, i*30, 800-i*80, 600-i*60);
            }

            // Desenhar Animatronic se estiver na câmera
            let present = false;
            state.animatronicPos.forEach((p, index) => {
                if(p === state.currentCam) {
                    c.fillStyle = index === 0 ? '#500' : '#050'; // Cores dos robôs
                    c.fillRect(200 + (index*100), 200, 150, 300);
                    // Olhos brilhantes
                    c.fillStyle = 'red';
                    c.beginPath();
                    c.arc(240+(index*100), 250, 5, 0, Math.PI*2);
                    c.arc(310+(index*100), 250, 5, 0, Math.PI*2);
                    c.fill();
                    present = true;
                }
            });

            if(!present) {
                c.fillStyle = 'white';
                c.font = '20px Courier';
                c.fillText("ÁREA VAZIA", 350, 300);
            }
        }

        /* --- MOVIMENTAÇÃO IA --- */
        function moveAnimatronics() {
            const diff = state.difficulty[state.currentNight];
            state.animatronicPos = state.animatronicPos.map(pos => {
                if(Math.random() * 20 < diff) {
                    let next = pos + 1;
                    if(next > 5) { // 5 é a zona de ataque
                        if(!state.isMonitorOpen) {
                           gameOver("jumpscare");
                        }
                        return 0; // Volta pro início
                    }
                    return next;
                }
                return pos;
            });
            
            // Visual do robô na porta (se estiver na pos 4 ou 5)
            const door = document.getElementById('door-threat');
            if(state.animatronicPos.includes(5)) {
                door.style.opacity = "1";
                door.style.right = "50px";
            } else {
                door.style.opacity = "0";
                door.style.right = "-200px";
            }

            if(state.isMonitorOpen) renderCam();
        }

        /* --- LÓGICA DE FIM DE JOGO --- */
        function gameOver(reason) {
            state.gameActive = false;
            showScreen('jumpscare-overlay');
            playBeep(100, 1);
            if(reason === 'jumpscare') {
                // Efeito visual de susto
                const jumpImg = document.getElementById('jumpscare-img');
                jumpImg.src = "https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExM3Z0dzR5YnptcGF6Ynd6YjF3eXN6Ynd6YjF3eXN6Ynd6YjF3eXN6JmVwPXYxX2ludGVybmFsX2dpZl9ieV9pZCZjdD1n/3BKf0IasgYp7W/giphy.gif";
                jumpImg.style.display = "block";
            }
        }

        function winNight() {
            state.gameActive = false;
            showScreen('win-screen');
            state.currentNight++;
            if(state.currentNight > 4) {
                document.getElementById('next-night-btn').innerText = "VER CRÉDITOS FINAIS";
                document.getElementById('next-night-btn').onclick = () => alert("OBRIGADO POR JOGAR! VOCÊ SOBREVIVEU ÀS 4 NOITES.");
            } else {
                document.getElementById('next-night-btn').onclick = startGame;
            }
        }

        /* --- MOVIMENTO DO MOUSE (OFFICE PAN) --- */
        document.addEventListener('mousemove', (e) => {
            if(!state.gameActive || state.isMonitorOpen) return;
            let percent = (e.clientX / window.innerWidth) - 0.5;
            state.officePan = percent * -100;
            document.getElementById('office-view').style.transform = `translateX(${state.officePan}px) rotateY(${percent * 10}deg)`;
        });

    </script>
</body>
</html>
